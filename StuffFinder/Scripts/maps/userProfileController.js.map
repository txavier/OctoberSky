{"version":3,"names":[],"mappings":"","sources":["userProfileController.js"],"sourcesContent":["(function () {\r\n    'use strict';\r\n\r\n    app.controller('userProfileController', userProfileController);\r\n\r\n    userProfileController.$inject = ['$scope', '$log', '$routeParams', '$location', 'dataService'];\r\n\r\n    function userProfileController($scope, $log, $routeParams, $location, dataService) {\r\n        var vm = this;\r\n\r\n        vm.users = [];\r\n        vm.user = {};\r\n        vm.user.cityId = null;\r\n        vm.user.nationalityId = null;\r\n        vm.user.nationality = {};\r\n        vm.user.nationality.name = null;\r\n        vm.user.city = {};\r\n        vm.user.city.name = null;\r\n        vm.addOrUpdateUser = addOrUpdateUser;\r\n        vm.nationalities = [];\r\n        vm.cities = [];\r\n\r\n        activate();\r\n\r\n        function activate() {\r\n            setView();\r\n\r\n            return vm;\r\n        }\r\n\r\n        function setView() {\r\n            return getUser().then(function () {\r\n                getNationalities().then(function () {\r\n                    if (vm.user.nationalityId) {\r\n                        vm.user.nationality = vm.nationalities[vm.nationalities.getIndexBy(\"nationalityId\", vm.user.nationalityId)];\r\n                    }\r\n                });\r\n\r\n                getCities().then(function () {\r\n                    if (vm.user.cityId) {\r\n                        vm.user.city = vm.cities[vm.cities.getIndexBy(\"cityId\", vm.user.cityId)];\r\n                    }\r\n                });\r\n\r\n                return vm.user;\r\n            });\r\n        }\r\n\r\n        Array.prototype.getIndexBy = function (name, value) {\r\n            for (var i = 0; i < this.length; i++) {\r\n                if (this[i][name] == value) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n\r\n        function getNationalities() {\r\n            return dataService.getNationalities().then(function (data) {\r\n                vm.nationalities = data;\r\n\r\n                return vm.nationalities;\r\n            });\r\n        }\r\n\r\n        function getCities() {\r\n            return dataService.getCities().then(function (data) {\r\n                vm.cities = data;\r\n\r\n                return vm.cities;\r\n            });\r\n        }\r\n\r\n        function getUser() {\r\n            return dataService.getLoggedInUser().then(function (data) {\r\n                vm.user = data;\r\n\r\n                return vm.user;\r\n            });\r\n        }\r\n\r\n        function addOrUpdateUser(user) {\r\n            if (!user.email\r\n                || !user.city\r\n                || !user.nationality) {\r\n                return;\r\n            }\r\n\r\n            user.cityId = user.city ? user.city.cityId : null;\r\n            user.nationalityId = user.nationality ? user.nationality.nationalityId : null;\r\n\r\n            user.thingCities = null;\r\n            user.nationality = null;\r\n            user.city = null;\r\n\r\n            return dataService.addOrUpdateUser(user)\r\n                .then(function () {\r\n                    $location.path('/start');\r\n                });\r\n        }\r\n\r\n    }\r\n\r\n})();"],"file":"userProfileController.js","sourceRoot":"/source/"}