{"version":3,"names":[],"mappings":"","sources":["loginController.js"],"sourcesContent":["'use strict';\r\napp.controller('loginController', ['$scope', '$location', 'authService', 'ngAuthSettings', 'dataService', function ($scope, $location, authService, ngAuthSettings, dataService) {\r\n    var serviceBase = ngAuthSettings.apiServiceBaseUri;\r\n\r\n    dataService.getServerUrl().then(function (resource) {\r\n        serviceBase = resource.authenticationServerUrl;\r\n    });\r\n\r\n    $scope.loginData = {\r\n        userName: \"\",\r\n        password: \"\",\r\n        useRefreshTokens: false\r\n    };\r\n\r\n    $scope.message = \"\";\r\n\r\n    $scope.login = function () {\r\n        authService.login($scope.loginData).then(function (response) {\r\n            dataService.getLoggedInUser().then(function (data) {\r\n                if (!data.email) {\r\n                    $location.path('/user-profile');\r\n                }\r\n                else {\r\n                    $location.path('/start');\r\n                }\r\n            });\r\n        },\r\n         function (err) {\r\n             $scope.message = err.error_description;\r\n         });\r\n    };\r\n\r\n    $scope.authExternalProvider = function (provider) {\r\n        var redirectUri = location.protocol + '//' + location.host + '/authcomplete.html';\r\n\r\n        var externalProviderUrl = serviceBase + \"api/Account/ExternalLogin?provider=\" + provider\r\n                                                                    + \"&response_type=token&client_id=\" + ngAuthSettings.clientId\r\n                                                                    + \"&redirect_uri=\" + redirectUri;\r\n        window.$windowScope = $scope;\r\n\r\n        var oauthWindow = window.open(externalProviderUrl, \"Authenticate Account\", \"location=0,status=0,width=600,height=750\");\r\n    };\r\n\r\n    $scope.authCompletedCB = function (fragment) {\r\n        $scope.$apply(function () {\r\n            if (fragment.haslocalaccount == 'False') {\r\n                authService.logOut();\r\n\r\n                authService.externalAuthData = {\r\n                    provider: fragment.provider,\r\n                    userName: fragment.external_user_name,\r\n                    externalAccessToken: fragment.external_access_token\r\n                };\r\n\r\n                $location.path('/associate');\r\n            }\r\n            else {\r\n                //Obtain access token and redirect to the start page.\r\n                var externalData = { provider: fragment.provider, externalAccessToken: fragment.external_access_token };\r\n                authService.obtainAccessToken(externalData).then(function (response) {\r\n                    $location.path('/start');\r\n\r\n                    $scope.$apply();\r\n                },\r\n             function (err) {\r\n                 $scope.message = err.error_description;\r\n             });\r\n            }\r\n        });\r\n    }\r\n\r\n    //$(document).ready(function () {\r\n    //    $(\".player\").mb_YTPlayer();\r\n    //});\r\n}]);"],"file":"loginController.js","sourceRoot":"/source/"}