{"version":3,"names":[],"mappings":"","sources":["whereIsItController.js"],"sourcesContent":["(function () {\r\n    'use strict';\r\n\r\n    app.controller('whereIsItController', whereIsItController);\r\n\r\n    whereIsItController.$inject = ['$scope', '$location', '$log', '$timeout', 'authService', 'dataService', 'thingService'];\r\n\r\n    function whereIsItController($scope, $location, $log, $timeout, authService, dataService, thingService) {\r\n\r\n        var vm = this;\r\n\r\n        vm.authentication = {};\r\n        vm.authentication.userName = authService.authentication.userName;\r\n        vm.thing = {};\r\n        vm.thing.thingCity = {};\r\n        vm.thing.thingCity.thingCityId = 0;\r\n        vm.thing.thingCity.city = {};\r\n        vm.thing.thingCity.cityId = 0;\r\n        vm.thing.thingCity.thingId = 0;\r\n        vm.thing.thingCity.userId = 0;\r\n        vm.thing.thingCities = [];\r\n        vm.thing.categoryId = null;\r\n        vm.categories = [];\r\n        vm.addOrUpdate = addOrUpdate;\r\n        vm.cities = [];\r\n\r\n        activate();\r\n\r\n        function activate() {\r\n            \r\n            getCategories();\r\n            getNewThing();\r\n            initiateDroplet();\r\n            getCities();\r\n\r\n            return vm;\r\n        }\r\n\r\n        function getCities() {\r\n            return dataService.getCities().then(function (data) {\r\n                vm.cities = data;\r\n\r\n                return vm.cities;\r\n            });\r\n        }\r\n\r\n        function initiateDroplet() {\r\n            $scope.$on('$dropletReady', function whenDropletReady() {\r\n                vm.interface.allowedExtensions(['png', 'jpg', 'bmp', 'gif']);\r\n\r\n                uploadFiles();\r\n            });\r\n        }\r\n\r\n        function uploadFiles() {\r\n            return dataService.getServerUrl().then(function (resource) {\r\n                var serverUrl = resource;\r\n\r\n                vm.interface.setRequestUrl(serverUrl.resourceServerUrl + 'api/thingsApi' + '/files');\r\n            });\r\n        }\r\n\r\n        // When the page is ready this plays the youtube video.\r\n        function playJumbotronVideo() {\r\n            //$(document).ready(function () {\r\n            //    $(\".player\").mb_YTPlayer();\r\n            //});\r\n        }\r\n\r\n        function getCategories() {\r\n            return dataService.getCategories().then(function(data) {\r\n                vm.categories = data;\r\n                return vm.categories;\r\n            });\r\n        }\r\n\r\n        function getNewThing() {\r\n            if (thingService.getThing() != null) {\r\n                vm.thing = thingService.getThing();\r\n\r\n                thingService.clearThing();\r\n            }\r\n\r\n            vm.thing.postedDate = new Date();\r\n\r\n            vm.thing.userName = authService.authentication.userName;\r\n\r\n            return vm.thing;\r\n        }\r\n\r\n        function addOrUpdate() {\r\n            vm.thing.userName = authService.authentication.userName;\r\n\r\n            vm.thing.thingCities.push(vm.thing.thingCity);\r\n\r\n            vm.thing.postedDate = new Date();\r\n\r\n            dataService.addOrUpdateThing(vm.thing)\r\n                .then(function (data) {\r\n                    vm.thing = data;\r\n\r\n                    vm.interface.setPostData({ id: vm.thing.thingId, userName: authService.authentication.userName });\r\n\r\n                    vm.interface.uploadFiles();\r\n\r\n                    $scope.$apply();\r\n\r\n                    history.back();\r\n                })\r\n                .catch(handleFailure);\r\n        }\r\n\r\n        function handleFailure(error) {\r\n            $log.error('Failure notice.' + error.data.message + ': ' + error.data.messageDetail);\r\n        }\r\n\r\n    }\r\n})();"],"file":"whereIsItController.js","sourceRoot":"/source/"}