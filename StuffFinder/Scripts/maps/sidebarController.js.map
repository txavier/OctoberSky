{"version":3,"names":[],"mappings":"","sources":["sidebarController.js"],"sourcesContent":["(function () {\r\n    'use strict';\r\n\r\n    app.controller('sidebarController', sidebarController);\r\n\r\n    sidebarController.$inject = ['$scope', '$location', '$log', 'authService', 'dataService', 'splashService', 'toaster'];\r\n\r\n    function sidebarController($scope, $location, $log, authService, dataService, splashService, toaster) {\r\n        var vm = this;\r\n\r\n        vm.authentication = {};\r\n        vm.authentication.userName = authService.authentication.userName;\r\n        vm.authentication.sidebarAuthenticationLabel = '';\r\n        vm.authentication.getSidebarAuthenticationLabel = getSidebarAuthenticationLabel;\r\n        vm.authentication.loginlogout = loginlogout;\r\n        vm.query = '';\r\n        vm.cities = [];\r\n        vm.searchCity = null;\r\n        vm.largeClass = 'hidden-lg';\r\n        vm.smallClass = 'visible-lg';\r\n        vm.changeClassEnter = changeClassEnter;\r\n        vm.changeClassLeave = changeClassLeave;\r\n        vm.activeClass = '';\r\n        // Regular screen large menu and small menu\r\n        vm.largeMenuClass = 'hidden-lg hidden-xs hidden-md hidden-sm';\r\n        vm.smallMenuClass = 'visible-lg hidden-xs visible-md hidden-sm';\r\n        vm.sidebarColumnClass = 'col-sm-1 col-xs-1';\r\n        vm.mainColumnClass = 'col-sm-11';\r\n        vm.toggleClasses = toggleClasses;\r\n        vm.smallScreenLargeMenuClass = 'hidden-lg hidden-xs hidden-md hidden-sm';\r\n        vm.smallScreenSmallMenuClass = 'hidden-lg visible-xs hidden-md visible-sm';\r\n        vm.loggedInUser = {};\r\n        vm.showDashboard = false;\r\n        vm.navigateSearch = navigateSearch;\r\n        vm.pop = pop;\r\n        vm.clearpop = clearpop;\r\n        vm.defaultCityIndex = 4;\r\n        vm.setShowSplash = setShowSplash;\r\n        vm.getShowSplash = getShowSplash;\r\n\r\n        // Scope references needed for deep watch on service variable.\r\n        // http://stackoverflow.com/questions/12576798/how-to-watch-service-variables\r\n        $scope.authService = authService;\r\n        $scope.authService.authentication = authService.authentication;\r\n        $scope.authService.authentication.userName = authService.authentication.userName;\r\n\r\n        activate();\r\n\r\n        function activate() {\r\n            getSidebarAuthenticationLabel();\r\n            setView();\r\n        }\r\n\r\n        $scope.$watch('authService.authentication.userName', function (current, original) {\r\n            $log.info('authService.authentication.userName was %s', original);\r\n            $log.info('authService.authentication.userName is now %s', current);\r\n\r\n            vm.authentication.userName = current;\r\n            getSidebarAuthenticationLabel();\r\n\r\n            if (authService.authentication.userName) {\r\n                getLoggedInUser().then(function (data) {\r\n                    if (vm.loggedInUser.isAdmin) {\r\n                        vm.showDashboard = true;\r\n                    }\r\n                    else {\r\n                        vm.showDashboard = false;\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                vm.showDashboard = false;\r\n            }\r\n        });\r\n\r\n        function pop() {\r\n            toaster.pop({\r\n                type: 'info',\r\n                title: 'Feedback',\r\n                body: 'We are a new site and we would LOVE to hear your comments, suggestions, and feeback.',\r\n                showCloseButton: true\r\n            });\r\n        }\r\n\r\n        function clearpop() {\r\n            toaster.clear('*');\r\n        }\r\n\r\n        function getLoggedInUser() {\r\n            return dataService.getLoggedInUser().then(function (data) {\r\n                vm.loggedInUser = data;\r\n            });\r\n        }\r\n\r\n        function toggleClasses() {\r\n            if (vm.smallScreenLargeMenuClass == 'hidden-lg hidden-xs hidden-sm') {\r\n                vm.smallScreenLargeMenuClass = 'hidden-lg visible-xs visible-sm';\r\n                vm.smallScreenSmallMenuClass = 'hidden-lg hidden-xs hidden-sm';\r\n                vm.sidebarColumnClass = 'col-sm-1 col-xs-2';\r\n                vm.activeClass = 'active';\r\n            }\r\n            else {\r\n                vm.smallScreenLargeMenuClass = 'hidden-lg hidden-xs hidden-sm';\r\n                vm.smallScreenSmallMenuClass = 'hidden-lg visible-xs visible-sm';\r\n                vm.sidebarColumnClass = 'col-sm-1 col-xs-1';\r\n                vm.activeClass = '';\r\n            }\r\n        }\r\n\r\n        function changeClassEnter() {\r\n            vm.activeClass = \"active\";\r\n            vm.largeMenuClass = 'visible-lg hidden-xs visible-md hidden-sm';\r\n            vm.smallMenuClass = 'hidden-lg hidden-xs hidden-md hidden-sm';\r\n            vm.smallScreenLargeMenuClass = 'hidden-lg visible-xs visible-sm';\r\n            vm.smallScreenSmallMenuClass = 'hidden-lg hidden-xs hidden-sm';\r\n            vm.sidebarColumnClass = 'col-sm-2 col-xs-1';\r\n            vm.mainColumnClass = 'col-sm-10';\r\n        }\r\n\r\n        function changeClassLeave() {\r\n            vm.activeClass = '';\r\n            vm.largeMenuClass = 'hidden-lg hidden-xs hidden-md hidden-sm';\r\n            vm.smallMenuClass = 'visible-lg hidden-xs visible-md';\r\n            vm.smallScreenLargeMenuClass = 'hidden-lg hidden-xs hidden-sm';\r\n            vm.smallScreenSmallMenuClass = 'hidden-lg visible-xs visible-sm';\r\n            vm.sidebarColumnClass = 'col-sm-1  col-xs-1';\r\n            vm.mainColumnClass = 'col-sm-11';\r\n        }\r\n\r\n        Array.prototype.getIndexBy = function (name, value) {\r\n            for (var i = 0; i < this.length; i++) {\r\n                if (this[i][name] == value) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n\r\n        function getCities() {\r\n            return dataService.getCities().then(function (data) {\r\n                vm.cities = data;\r\n            });\r\n        }\r\n\r\n        function setDropDown() {\r\n            vm.cities.splice(0, 0, { name: \"All Cities\" });\r\n\r\n            if (authService.authentication.userName) {\r\n                getLoggedInUser().then(function (data) {\r\n                    if (vm.loggedInUser.cityId) {\r\n                        vm.searchCity = vm.cities[vm.cities.getIndexBy(\"cityId\", vm.loggedInUser.cityId)];\r\n                    }\r\n                    else {\r\n                        vm.searchCity = vm.cities[vm.defaultCityIndex];\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                vm.searchCity = vm.cities[vm.defaultCityIndex];\r\n            }\r\n        }\r\n\r\n        function setView() {\r\n            getCities().then(function (data) {\r\n                setDropDown();\r\n            });\r\n        }\r\n\r\n        function getSidebarAuthenticationLabel() {\r\n            vm.authentication.sidebarAuthenticationLabel = vm.authentication.userName ? vm.authentication.userName + ' ' + 'Sign Out' : 'Sign In';\r\n\r\n            return vm.authentication.sidebarAuthenticationLabel;\r\n        }\r\n\r\n        // If the person is logged in then this method will log them out.\r\n        // If the person is logged out then this method will take them to\r\n        // the log in page.\r\n        function loginlogout() {\r\n            // If the is auth is false then we want to login now.\r\n            if (authService.authentication.isAuth) {\r\n                authService.logOut();\r\n\r\n                vm.showDashboard = false;\r\n            }\r\n            else {\r\n                $location.path(\"/home\");\r\n            }\r\n        }\r\n\r\n        function navigateSearch() {\r\n            $log.log('In navigateSearch');\r\n\r\n            $location.path('/search/' + (vm.searchCity.name || 'all' | escape) + '/' + (vm.query || '' | escape));\r\n        }\r\n\r\n        function setShowSplash(showSplash) {\r\n            splashService.setShowSplash(showSplash);\r\n        }\r\n\r\n        function getShowSplash() {\r\n            return splashService.getShowSplash();\r\n        }\r\n    }\r\n})();"],"file":"sidebarController.js","sourceRoot":"/source/"}